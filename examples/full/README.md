<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Full AVS example with Vnet ExpressRoute Gateway

This example demonstrates most of the deployment inputs using a single Azure VMware Solution private cloud with the following features and supporting test resources:

    - A 3-node management cluster and an additional 3-node cluster
    - The HCX Addon enabled with the Enterprise license sku
    - An example HCX site key
    - Diagnostic Settings to send the syslog and metrics to a Log Analytics workspace.
    - Two domain controllers running a simple test active directory domain for use in demonstrating identity provider and dns functionality including
        - Nat Gateway enabled for outbound internet access to download the configuration script from github
        - Bastion enabled for accessing the domain controllers to use them for connecting to vcenter and nsxt for validation and testing
    - A DNS forwarder zone for the test domain
    - A DHCP server configured in NSX-T
    - An update to the default NSX-T DNS service adding the custom domain forwarder zone
    - An ExpressRoute authorization key
    - An ExpressRoute Gateway connection to an example ExpressRoute gateway in a virtual network.
    - A delete lock on the private cloud resource
    - The system-managed identity enabled
    - An Azure Netapp Files (ANF) Account, Pool, and Volume created in the same availalbility zone for testing external storage
    - An external storage datastore created using the ANF volume and associated to the management cluster
    - A role assignment assigning Contributor rights on the private cloud resource to the deployment user to demonstrate resource level RBAC
    - A tags block to demonstrate the assignment of resource level tags
    - A Vcenter identity sources block to demonstrate the use of the test domain for ldaps       

The following example code uses several test modules, so be sure to include them and update the deployment regions if copying verbatim.

```hcl
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.4.2"
}

module "regions" {
  source  = "Azure/avm-utl-regions/azurerm"
  version = "0.5.0"

  availability_zones_filter = true
}

locals {
  #dc_vm_sku             = "Standard_D2_v4"
  ldap_user_name        = "ldapuser"
  test_admin_group_name = "vcenterAdmins"
  test_admin_user_name  = "testadmin"
  test_domain_dn        = "dc=test,dc=local"
  test_domain_name      = "test.local"
  test_domain_netbios   = "test"
}

data "azurerm_client_config" "current" {}

module "generate_deployment_region" {
  source = "../../modules/generate_deployment_region"

  #source               = "git::https://github.com/Azure/terraform-azurerm-avm-res-avs-privatecloud.git//modules/generate_deployment_region"
  management_cluster_quota_required = 3
  private_cloud_generation          = 1
  secondary_cluster_quota_required  = 3
  test_regions = [
    "australiaeast",
    "brazilsouth",
    "canadaeast",
    "centralindia",
    "centralus",
    "eastasia",
    "eastus",
    "eastus2",
    "francecentral",
    "germanywestcentral",
    "italynorth",
    "japaneast",
    "japanwest",
    "northeurope",
    "qatarcentral",
    "southafricanorth",
    "southcentralus",
    "southeastasia",
    "swedencentral",
    "switzerlandnorth",
    "uaenorth",
    "uksouth",
    "westeurope",
    "westus2",
    "westus3"
  ]
}

resource "local_file" "region_sku_cache" {
  filename = "${path.module}/region_cache.cache"
  content  = jsonencode(module.generate_deployment_region.deployment_region)

  lifecycle {
    ignore_changes = [content]
  }
}

resource "azurerm_resource_group" "this" {
  location = jsondecode(local_file.region_sku_cache.content).name
  name     = module.naming.resource_group.name_unique

  lifecycle {
    ignore_changes = [tags, location]
  }
}

module "vm_sku" {
  source  = "Azure/avm-utl-sku-finder/azapi"
  version = "0.3.0"

  location      = "westus3" #azurerm_resource_group.this.location
  cache_results = true
  vm_filters = {
    min_vcpus            = 2
    max_vcpus            = 2
    premium_io_supported = true
    location_zone        = null

    #location_zone = module.test_private_cloud.resource.properties.availability.zone
  }
}

resource "azurerm_resource_group" "this_secondary" {
  location = "westus3" #module.regions.regions_by_name[jsondecode(local_file.region_sku_cache.content).name].paired_region_name
  name     = "${module.naming.resource_group.name_unique}-secondary"

  lifecycle {
    ignore_changes = [tags, location]
  }
}

module "avm_res_keyvault_vault" {
  source  = "Azure/avm-res-keyvault-vault/azurerm"
  version = "0.10.0"

  location               = azurerm_resource_group.this.location
  name                   = module.naming.key_vault.name_unique
  resource_group_name    = azurerm_resource_group.this.name
  tenant_id              = data.azurerm_client_config.current.tenant_id
  enabled_for_deployment = true
  keys = {
    "cmk-disk-key" = {
      name     = "cmk-disk-key"
      key_type = "RSA"
      key_size = 2048

      key_opts = [
        "decrypt",
        "encrypt",
        "sign",
        "unwrapKey",
        "verify",
        "wrapKey",
      ]
    }
  }
  network_acls = {
    default_action = "Allow"
    bypass         = "AzureServices"
  }
  role_assignments = {
    deployment_user_secrets = {
      role_definition_id_or_name = "Key Vault Administrator"
      principal_id               = data.azurerm_client_config.current.object_id
    }
    deployment_user_keys = { #give the deployment user access to keys
      role_definition_id_or_name = "Key Vault Crypto Officer"
      principal_id               = data.azurerm_client_config.current.object_id
    }
    system_managed_identity_keys = { #give the system assigned managed identity for the disk encryption set access to keys
      role_definition_id_or_name = "Key Vault Crypto Officer"
      principal_id               = module.test_private_cloud.identity.principalId
    }
  }
  wait_for_rbac_before_key_operations = {
    create = "60s"
  }
  wait_for_rbac_before_secret_operations = {
    create = "60s"
  }
}

/*
data "azapi_resource" "cmk_key" {
  type = "Microsoft.KeyVault/vaults/keys@2023-07-01"
  resource_id = module.avm_res_keyvault_vault.keys_resource_ids.cmk_key.resource_id
}
*/

data "azurerm_key_vault_key" "cmk_key" {
  key_vault_id = module.avm_res_keyvault_vault.resource_id
  name         = split("/", module.avm_res_keyvault_vault.keys["cmk-disk-key"].resource_id)[10]
}

module "gateway_vnet_primary_region" {
  source  = "Azure/avm-res-network-virtualnetwork/azurerm"
  version = "=0.7.1"

  address_space       = ["10.100.0.0/16"]
  location            = azurerm_resource_group.this.location
  resource_group_name = azurerm_resource_group.this.name
  name                = "HubVnet-${azurerm_resource_group.this.location}"
  subnets = {
    GatewaySubnet = {
      name             = "GatewaySubnet"
      address_prefixes = ["10.100.0.0/24"]
    }
    DCSubnet = {
      name             = "DCSubnet"
      address_prefixes = ["10.100.1.0/24"]
      nat_gateway = {
        id = azurerm_nat_gateway.this_nat_gateway.id
      }
    }
    AzureBastionSubnet = {
      name             = "AzureBastionSubnet"
      address_prefixes = ["10.100.2.0/24"]
    }
    ElasticSanSubnet = {
      name             = "ElasticSanSubnet"
      address_prefixes = ["10.100.4.0/24"]
    }
    ANFSubnet = {
      name             = "ANFSubnet"
      address_prefixes = ["10.100.3.0/24"]
      delegation = [
        {
          name = "Microsoft.Netapp/volumes"
          service_delegation = {
            name = "Microsoft.Netapp/volumes"
          }
        }
      ]
    }
  }
}

resource "azurerm_public_ip" "nat_gateway" {
  allocation_method   = "Static"
  location            = azurerm_resource_group.this.location
  name                = "${module.naming.nat_gateway.name_unique}-pip"
  resource_group_name = azurerm_resource_group.this.name
  sku                 = "Standard"
  zones               = null
}

resource "azurerm_nat_gateway" "this_nat_gateway" {
  location            = azurerm_resource_group.this.location
  name                = module.naming.nat_gateway.name_unique
  resource_group_name = azurerm_resource_group.this.name
  sku_name            = "Standard"
}

resource "azurerm_nat_gateway_public_ip_association" "this_nat_gateway" {
  nat_gateway_id       = azurerm_nat_gateway.this_nat_gateway.id
  public_ip_address_id = azurerm_public_ip.nat_gateway.id
}

module "gateway_vnet_secondary_region" {
  source  = "Azure/avm-res-network-virtualnetwork/azurerm"
  version = "=0.7.1"

  address_space       = ["10.101.0.0/16"]
  location            = azurerm_resource_group.this_secondary.location
  resource_group_name = azurerm_resource_group.this_secondary.name
  name                = "HubVnet-${azurerm_resource_group.this_secondary.location}-2"
  subnets = {
    GatewaySubnet = {
      name             = "GatewaySubnet"
      address_prefixes = ["10.101.0.0/24"]
    }
    DCSubnet = {
      name                            = "DCSubnet"
      address_prefixes                = ["10.101.1.0/24"]
      default_outbound_access_enabled = true
    }
    AzureBastionSubnet = {
      name             = "AzureBastionSubnet"
      address_prefixes = ["10.101.2.0/24"]
    }
    ElasticSanSubnet = {
      name             = "ElasticSanSubnet"
      address_prefixes = ["10.101.4.0/24"]
      nat_gateway = {
        id = azurerm_nat_gateway.this_nat_gateway_2.id
      }
      delegation = [
        {
          name = "Microsoft.App/environments"
          service_delegation = {
            name = "Microsoft.App/environments"
          }
        }
      ]
    }
    ANFSubnet = {
      name             = "ANFSubnet"
      address_prefixes = ["10.101.3.0/24"]
      delegation = [
        {
          name = "Microsoft.Netapp/volumes"
          service_delegation = {
            name = "Microsoft.Netapp/volumes"
          }
        }
      ]
    }
  }
}

resource "azurerm_public_ip" "nat_gateway_2" {
  allocation_method   = "Static"
  location            = "westus3"
  name                = "${module.naming.nat_gateway.name_unique}-pip-2"
  resource_group_name = azurerm_resource_group.this.name
  sku                 = "Standard"
  zones               = ["1", "2", "3"]
}

resource "azurerm_nat_gateway" "this_nat_gateway_2" {
  location            = "westus3"
  name                = "${module.naming.nat_gateway.name_unique}-2"
  resource_group_name = azurerm_resource_group.this.name
  sku_name            = "Standard"
}

module "avm_res_keyvault_vault_2" {
  source  = "Azure/avm-res-keyvault-vault/azurerm"
  version = "0.10.0"

  location               = "westus3"
  name                   = "${module.naming.key_vault.name_unique}-2"
  resource_group_name    = azurerm_resource_group.this.name
  tenant_id              = data.azurerm_client_config.current.tenant_id
  enabled_for_deployment = true
  keys = {
    "cmk-disk-key" = {
      name     = "cmk-disk-key"
      key_type = "RSA"
      key_size = 2048

      key_opts = [
        "decrypt",
        "encrypt",
        "sign",
        "unwrapKey",
        "verify",
        "wrapKey",
      ]
    }
  }
  network_acls = {
    default_action = "Allow"
    bypass         = "AzureServices"
  }
  role_assignments = {
    deployment_user_secrets = {
      role_definition_id_or_name = "Key Vault Administrator"
      principal_id               = data.azurerm_client_config.current.object_id
    }
    deployment_user_keys = { #give the deployment user access to keys
      role_definition_id_or_name = "Key Vault Crypto Officer"
      principal_id               = data.azurerm_client_config.current.object_id
    }
    system_managed_identity_keys = { #give the system assigned managed identity for the disk encryption set access to keys
      role_definition_id_or_name = "Key Vault Crypto Officer"
      principal_id               = module.test_private_cloud.identity.principalId
    }
  }
  wait_for_rbac_before_key_operations = {
    create = "60s"
  }
  wait_for_rbac_before_secret_operations = {
    create = "60s"
  }
}

module "create_dc" {
  source = "../../modules/create_test_domain_controllers"

  dc_subnet_resource_id       = module.gateway_vnet_secondary_region.subnets["DCSubnet"].resource_id #module.gateway_vnet_primary_region.subnets["DCSubnet"].resource_id
  dc_vm_name                  = "dc01-${module.naming.virtual_machine.name_unique}"
  dc_vm_name_secondary        = "dc02-${module.naming.virtual_machine.name_unique}"
  key_vault_resource_id       = module.avm_res_keyvault_vault_2.resource_id #module.avm_res_keyvault_vault.resource_id
  private_ip_address          = cidrhost("10.100.1.0/24", 4)
  resource_group_location     = "westus3" #azurerm_resource_group.this.location
  resource_group_name         = azurerm_resource_group.this.name
  virtual_network_resource_id = module.gateway_vnet_secondary_region.resource_id #module.gateway_vnet_primary_region.resource_id
  admin_group_name            = local.test_admin_group_name
  bastion_name                = module.naming.bastion_host.name_unique
  bastion_pip_name            = "${module.naming.bastion_host.name_unique}-pip"
  bastion_subnet_resource_id  = module.gateway_vnet_secondary_region.subnets["AzureBastionSubnet"].resource_id #module.gateway_vnet_primary_region.subnets["AzureBastionSubnet"].resource_id
  create_bastion              = true
  dc_vm_sku                   = module.vm_sku.sku
  domain_distinguished_name   = local.test_domain_dn
  domain_fqdn                 = local.test_domain_name
  domain_netbios_name         = local.test_domain_netbios
  ldap_user                   = local.ldap_user_name
  test_admin_user             = local.test_admin_user_name

  depends_on = [module.avm_res_keyvault_vault, module.gateway_vnet_primary_region, azurerm_nat_gateway.this_nat_gateway, azurerm_virtual_network_gateway.gateway]
}


resource "azurerm_log_analytics_workspace" "this_workspace" {
  location            = azurerm_resource_group.this.location
  name                = module.naming.log_analytics_workspace.name_unique
  resource_group_name = azurerm_resource_group.this.name
  retention_in_days   = 30
  sku                 = "PerGB2018"
}

resource "azurerm_public_ip" "gatewaypip" {
  allocation_method   = "Static"
  location            = azurerm_resource_group.this.location
  name                = module.naming.public_ip.name_unique
  resource_group_name = azurerm_resource_group.this.name
  sku                 = "Standard" #required for an ultraperformance gateway
  zones               = null
}

resource "azurerm_virtual_network_gateway" "gateway" {
  location            = azurerm_resource_group.this.location
  name                = module.naming.express_route_gateway.name_unique
  resource_group_name = azurerm_resource_group.this.name
  sku                 = "Standard" #Setting this to Standard so we can test in non-AZ regions
  type                = "ExpressRoute"

  ip_configuration {
    subnet_id                     = module.gateway_vnet_primary_region.subnets["GatewaySubnet"].resource_id
    name                          = "default"
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.gatewaypip.id
  }

  lifecycle {
    ignore_changes = [ip_configuration]
  }
}

resource "azurerm_public_ip" "gatewaypip_secondary" {
  allocation_method   = "Static"
  location            = azurerm_resource_group.this_secondary.location
  name                = "${module.naming.public_ip.name_unique}-secondary"
  resource_group_name = azurerm_resource_group.this_secondary.name
  sku                 = "Standard" #required for an ultraperformance gateway
  zones               = ["1", "2", "3"]
}

resource "azurerm_virtual_network_gateway" "gateway_secondary" {
  location            = azurerm_resource_group.this_secondary.location
  name                = "${module.naming.express_route_gateway.name_unique}-secondary"
  resource_group_name = azurerm_resource_group.this_secondary.name
  sku                 = "Standard" #Setting this to Standard so we can test in non-AZ regions
  type                = "ExpressRoute"

  ip_configuration {
    subnet_id                     = module.gateway_vnet_secondary_region.subnets["GatewaySubnet"].resource_id
    name                          = "default"
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.gatewaypip_secondary.id
  }

  lifecycle {
    ignore_changes = [ip_configuration]
  }
}
/*
module "create_anf_volume" {
  source = "../../modules/create_test_netapp_volume"
  #source = "git::https://github.com/Azure/terraform-azurerm-avm-res-avs-privatecloud.git//modules/create_test_netapp_volume"

  resource_group_name     = azurerm_resource_group.this.name
  resource_group_location = azurerm_resource_group.this.location
  anf_account_name        = "anf-${module.naming.storage_share.name_unique}"
  anf_pool_name           = "anf-pool-${module.naming.storage_share.name_unique}"
  anf_pool_size           = 4
  anf_volume_name         = "anf-volume-${module.naming.storage_share.name_unique}"
  anf_volume_size         = 4096
  anf_subnet_resource_id  = module.gateway_vnet_primary_region.subnets["ANFSubnet"].resource_id
  anf_zone_number         = try(module.test_private_cloud.resource.properties.availability.zone, 1)
  anf_nfs_allowed_clients = ["0.0.0.0/0"]
}


module "elastic_san" {
  source = "../../modules/create_elastic_san_volume"
  #source                = "git::https://github.com/Azure/terraform-azurerm-avm-res-avs-privatecloud.git//modules/create_elastic_san_volume"
  elastic_san_name      = "esan-${module.naming.storage_share.name_unique}"
  resource_group_id     = azurerm_resource_group.this.id
  location              = azurerm_resource_group.this.location
  base_size_in_tib      = 1
  extended_size_in_tib  = 1
  zones                 = [try(module.test_private_cloud.resource.properties.availability.zone, 1)]
  public_network_access = "Enabled"

  sku = {
    name = "Premium_LRS"
    tier = "Premium"
  }

  elastic_san_volume_groups = {
    vg_1 = {
      name          = "esan-vg-${module.naming.storage_share.name_unique}"
      protocol_type = "iSCSI"
      volumes = {
        volume_1 = {
          name        = "esan-vol-${module.naming.storage_share.name_unique}-01"
          size_in_gib = 100
        }
      }

      private_link_service_connections = {
        pls_conn_1 = {
          private_endpoint_name                = "esan-${module.naming.private_endpoint.name_unique}"
          resource_group_name                  = azurerm_resource_group.this.name
          resource_group_location              = azurerm_resource_group.this.location
          esan_subnet_resource_id              = module.gateway_vnet_primary_region.subnets["ElasticSanSubnet"].resource_id
          private_link_service_connection_name = "esan-${module.naming.private_service_connection.name_unique}"
        }
      }
    }
  }
}
*/
module "test_private_cloud" {
  source = "../../"

  avs_network_cidr           = "10.0.0.0/22"
  location                   = azurerm_resource_group.this.location
  name                       = "avs-sddc-${substr(module.naming.unique-seed, 0, 4)}"
  resource_group_name        = azurerm_resource_group.this.name
  resource_group_resource_id = azurerm_resource_group.this.id
  sku_name                   = jsondecode(local_file.region_sku_cache.content).sku-mgmt
  addons = {
    HCX = {
      hcx_key_names    = ["example_key_1", "example_key_2"]
      hcx_license_type = "Enterprise"
    }
  }
  customer_managed_key = {
    key_vault_resource_id = module.avm_res_keyvault_vault.resource_id
    key_name              = data.azurerm_key_vault_key.cmk_key.name
    key_version           = data.azurerm_key_vault_key.cmk_key.version
  }
  dhcp_configuration = {
    server_config = {
      display_name      = "test_dhcp"
      dhcp_type         = "SERVER"
      server_lease_time = 14400
      server_address    = "10.101.0.1/24"
    }
  }
  diagnostic_settings = {
    avs_diags = {
      name                  = module.naming.monitor_diagnostic_setting.name_unique
      workspace_resource_id = azurerm_log_analytics_workspace.this_workspace.id
      metric_categories     = ["AllMetrics"]
      log_groups            = ["allLogs"]
    }
  }
  dns_forwarder_zones = {
    test_local = {
      display_name               = local.test_domain_name
      dns_server_ips             = [module.create_dc.dc_details.private_ip_address]
      domain_names               = [module.create_dc.domain_fqdn]
      add_to_default_dns_service = true
    }
  }
  enable_telemetry = var.enable_telemetry
  expressroute_connections = {
    region1 = {
      name                             = "exr-connection-${azurerm_resource_group.this.location}"
      expressroute_gateway_resource_id = azurerm_virtual_network_gateway.gateway.id
      authorization_key_name           = "test_auth_key-${azurerm_resource_group.this.location}"
      deployment_order                 = 1
    }
    region2 = {
      name                               = "exr-connection-${azurerm_resource_group.this_secondary.location}"
      expressroute_gateway_resource_id   = azurerm_virtual_network_gateway.gateway_secondary.id
      authorization_key_name             = "test_auth_key-${azurerm_resource_group.this_secondary.location}"
      network_resource_group_resource_id = azurerm_resource_group.this_secondary.id
      network_resource_group_location    = azurerm_resource_group.this_secondary.location
      deployment_order                   = 2
    }
  }
  extended_network_blocks        = ["10.10.0.0/23"]
  external_storage_address_block = "10.20.0.0/24"
  internet_enabled               = true
  lock = {
    name = "lock-avs-sddc-${substr(module.naming.unique-seed, 0, 4)}"
    kind = "CanNotDelete"
  }
  managed_identities = {
    system_assigned = true
  }
  management_cluster_size = 3
  role_assignments = {
    deployment_user_contributor = {
      role_definition_id_or_name = "Contributor"
      principal_id               = data.azurerm_client_config.current.client_id
      principal_type             = "ServicePrincipal"
    }
  }
  segments = {
    segment_1 = {
      display_name    = "segment_1"
      gateway_address = "10.20.0.1/24"
      dhcp_ranges     = ["10.20.0.5-10.20.0.100"]
    }
    segment_2 = {
      display_name    = "segment_2"
      gateway_address = "10.30.0.1/24"
    }
  }
  tags = {
    scenario = "avs_full_example"
  }
  vcenter_identity_sources = {
    test_local = {
      alias          = module.create_dc.domain_netbios_name
      base_group_dn  = module.create_dc.domain_distinguished_name
      base_user_dn   = module.create_dc.domain_distinguished_name
      domain         = module.create_dc.domain_fqdn
      group_name     = "vcenterAdmins"
      name           = module.create_dc.domain_fqdn
      primary_server = "ldaps://${module.create_dc.dc_details.name}.${module.create_dc.domain_fqdn}:636"
      #secondary_server = "ldaps://${module.create_dc.dc_details_secondary.name}.${module.create_dc.domain_fqdn}:636"
      ssl = "Enabled"
    }
  }
  vcenter_identity_sources_credentials = {
    test_local = {
      ldap_user          = module.create_dc.ldap_user
      ldap_user_password = module.create_dc.ldap_user_password
    }
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (~> 1.10)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.35)

- <a name="requirement_local"></a> [local](#requirement\_local) (~> 2.5)

## Resources

The following resources are used by this module:

- [azurerm_log_analytics_workspace.this_workspace](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/log_analytics_workspace) (resource)
- [azurerm_nat_gateway.this_nat_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/nat_gateway) (resource)
- [azurerm_nat_gateway.this_nat_gateway_2](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/nat_gateway) (resource)
- [azurerm_nat_gateway_public_ip_association.this_nat_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/nat_gateway_public_ip_association) (resource)
- [azurerm_public_ip.gatewaypip](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip) (resource)
- [azurerm_public_ip.gatewaypip_secondary](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip) (resource)
- [azurerm_public_ip.nat_gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip) (resource)
- [azurerm_public_ip.nat_gateway_2](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip) (resource)
- [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_resource_group.this_secondary](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_virtual_network_gateway.gateway](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network_gateway) (resource)
- [azurerm_virtual_network_gateway.gateway_secondary](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network_gateway) (resource)
- [local_file.region_sku_cache](https://registry.terraform.io/providers/hashicorp/local/latest/docs/resources/file) (resource)
- [azurerm_client_config.current](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/client_config) (data source)
- [azurerm_key_vault_key.cmk_key](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/key_vault_key) (data source)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_enable_telemetry"></a> [enable\_telemetry](#input\_enable\_telemetry)

Description: This variable controls whether or not telemetry is enabled for the module.  
For more information see https://aka.ms/avm/telemetryinfo.  
If it is set to false, then no telemetry will be collected.

Type: `bool`

Default: `true`

## Outputs

The following outputs are exported:

### <a name="output_hcx_cloud_manager_endpoint_hostname"></a> [hcx\_cloud\_manager\_endpoint\_hostname](#output\_hcx\_cloud\_manager\_endpoint\_hostname)

Description: The hcx cloud manager hostname

### <a name="output_hcx_cloud_manager_endpoint_https"></a> [hcx\_cloud\_manager\_endpoint\_https](#output\_hcx\_cloud\_manager\_endpoint\_https)

Description: n/a

### <a name="output_nsxt_manager_endpoint_hostname"></a> [nsxt\_manager\_endpoint\_hostname](#output\_nsxt\_manager\_endpoint\_hostname)

Description: The nsxt endpoint hostname

### <a name="output_nsxt_manager_endpoint_https"></a> [nsxt\_manager\_endpoint\_https](#output\_nsxt\_manager\_endpoint\_https)

Description: n/a

### <a name="output_resource"></a> [resource](#output\_resource)

Description: Example output of the full private cloud resource output.

### <a name="output_vcsa_endpoint_hostname"></a> [vcsa\_endpoint\_hostname](#output\_vcsa\_endpoint\_hostname)

Description: The vcsa endpoint hostname

### <a name="output_vcsa_endpoint_https"></a> [vcsa\_endpoint\_https](#output\_vcsa\_endpoint\_https)

Description: The https endpoint for vcsa

## Modules

The following Modules are called:

### <a name="module_avm_res_keyvault_vault"></a> [avm\_res\_keyvault\_vault](#module\_avm\_res\_keyvault\_vault)

Source: Azure/avm-res-keyvault-vault/azurerm

Version: 0.10.0

### <a name="module_avm_res_keyvault_vault_2"></a> [avm\_res\_keyvault\_vault\_2](#module\_avm\_res\_keyvault\_vault\_2)

Source: Azure/avm-res-keyvault-vault/azurerm

Version: 0.10.0

### <a name="module_create_dc"></a> [create\_dc](#module\_create\_dc)

Source: ../../modules/create_test_domain_controllers

Version:

### <a name="module_gateway_vnet_primary_region"></a> [gateway\_vnet\_primary\_region](#module\_gateway\_vnet\_primary\_region)

Source: Azure/avm-res-network-virtualnetwork/azurerm

Version: =0.7.1

### <a name="module_gateway_vnet_secondary_region"></a> [gateway\_vnet\_secondary\_region](#module\_gateway\_vnet\_secondary\_region)

Source: Azure/avm-res-network-virtualnetwork/azurerm

Version: =0.7.1

### <a name="module_generate_deployment_region"></a> [generate\_deployment\_region](#module\_generate\_deployment\_region)

Source: ../../modules/generate_deployment_region

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.4.2

### <a name="module_regions"></a> [regions](#module\_regions)

Source: Azure/avm-utl-regions/azurerm

Version: 0.5.0

### <a name="module_test_private_cloud"></a> [test\_private\_cloud](#module\_test\_private\_cloud)

Source: ../../

Version:

### <a name="module_vm_sku"></a> [vm\_sku](#module\_vm\_sku)

Source: Azure/avm-utl-sku-finder/azapi

Version: 0.3.0

<!-- markdownlint-disable-next-line MD041 -->
## Data Collection

The software may collect information about you and your use of the software and send it to Microsoft. Microsoft may use this information to provide services and improve our products and services. You may turn off the telemetry as described in the repository. There are also some features in the software that may enable you and Microsoft to collect data from users of your applications. If you use these features, you must comply with applicable law, including providing appropriate notices to users of your applications together with a copy of Microsoftâ€™s privacy statement. Our privacy statement is located at <https://go.microsoft.com/fwlink/?LinkID=824704>. You can learn more about data collection and use in the help documentation and our privacy statement. Your use of the software operates as your consent to these practices.
<!-- END_TF_DOCS -->